<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">

<!-- jQuery -->
<script th:src="@{https://code.jquery.com/jquery-3.6.0.min.js}"></script>

<head th:replace="layout/header :: head (VIVIDO)">		
</head>


<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
 	<sidebar th:replace="layout/sidebar :: sidebar"></sidebar>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
         <main th:replace="layout/main :: main"></main>
			<!--  컨텐츠 작성란 -->		 
			<div class="container mt-5">
			    <!-- 상품 등록 카드 -->
			    <div class="card shadow-lg rounded">
			        <div class="card-header bg-primary text-white">
			            <h2 class="h4 mb-0">상품 등록</h2>
			        </div>
			        <div class="card-body">
			            <form onsubmit="event.preventDefault(); registerProduct();" id="productForm">
			                <div class="table-responsive">
			                    <table class="table table-bordered">
			                        <tbody>
			                            <!-- 상품 ID -->
			                            <tr>
			                                <th scope="row" class="align-middle">상품 ID</th>
			                                <td>
			                                    <input type="text" class="form-control form-control-sm" id="productId" placeholder="상품 ID 입력" required>
			                                </td>
			                            </tr>
			
			                            <!-- 카테고리 -->
			                            <tr>
			                                <th scope="row" class="align-middle">카테고리</th>
			                                <td>
			                                    <div class="d-flex">
			                                        <!-- 카테고리 박스 -->
			                                        <select class="form-control form-control-sm mr-3" id="productCategory" onchange="updateSubCategory();">
			                                            <option value="">카테고리 선택</option>
			                                            <option value="electronics">전자제품</option>
			                                            <option value="clothing">의류</option>
			                                            <option value="books">도서</option>
			                                        </select>
			                                        
			                                        <!-- 세분류 박스 -->
			                                        <select class="form-control form-control-sm" id="productCategoryDetails" style="display:none;">
			                                            <option value="">세분류 선택</option>
			                                            <!-- 세분류 항목은 선택된 카테고리에 따라 동적으로 변경됩니다 -->
			                                        </select>
			                                    </div>
			                                </td>
			                            </tr>
			                            <!-- 상품명 -->
			                            <tr>
			                                <th scope="row" class="align-middle">상품명</th>
			                                <td>
			                                    <input type="text" class="form-control form-control-sm" id="productName" placeholder="상품명 입력" required>
			                                </td>
			                            </tr>
			                            <!-- 가격 -->
			                            <tr>
			                                <th scope="row" class="align-middle">가격</th>
			                                <td>
			                                    <input type="number" class="form-control form-control-sm" id="productPrice" placeholder="가격 입력" required>
			                                </td>
			                            </tr>
			                            <!-- 할인율 -->
			                            <tr>
			                                <th scope="row" class="align-middle">할인율</th>
			                                <td>
			                                    <input type="number" class="form-control form-control-sm" id="discountRate" placeholder="할인율 입력">
			                                </td>
			                            </tr>
			                            <!-- 재고 -->
			                            <tr>
			                                <th scope="row" class="align-middle">재고</th>
			                                <td>
			                                    <input type="number" class="form-control form-control-sm" id="productStock" placeholder="재고 입력" required>
			                                </td>
			                            </tr>
			
										<tr>
										    <th scope="row" class="align-middle">상품 키워드</th>
										    <td>
										        <input type="text" class="form-control form-control-sm" id="productKeyword" placeholder="상품 키워드 입력" required>
										    </td>
										</tr>
										<tr>
										    <th scope="row" class="align-middle">브랜드</th>
										    <td>
										        <input type="text" class="form-control form-control-sm" id="brand" placeholder="상품 브랜드 입력" required>
										    </td>
										</tr>
										<tr>
										    <th scope="row" class="align-middle">제조사</th>
										    <td>
										        <input type="text" class="form-control form-control-sm" id="manufacturer" placeholder="상품 제조사 입력" required>
										    </td>
										</tr>
			
										<tr>
										    <th scope="row" class="align-middle">원산지</th>
										    <td>
										        <input type="text" class="form-control form-control-sm" id="productOrigin" placeholder="상품 원산지 입력" required>
										    </td>
										</tr>
			
										<tr>
											<th scope="row" class="align-middle">비고 입력</th>
											<td>
												<input type="text" class="form-control form-control-sm" id="comments" placeholder="상품 내용 입력">
											 </td>
										</tr>
			
			
										<tr>
										    <th scope="row" class="align-middle">등록일</th>
										    <td>
										        <input type="text" class="form-control form-control-sm" id="createDate" readonly>
										    </td>
										</tr>
										
				                    <!-- 상품 내용 -->
									      <tr>
									          <th scope="row" class="align-middle">상품 내용</th>
									          <td>
									              <!-- 썸머노트 에디터로 변환될 textarea -->
									              <textarea class="form-control form-control-sm" id="productContent" rows="4" placeholder="상품 내용을 입력하세요..."></textarea>
									          </td>
									      </tr>
			
										
									<!-- 이미지 업로드 -->
									<tr>
									    <th scope="row" class="align-middle">상품 이미지</th>
									    <td>
									        <!-- 첨부파일 업로드 -->
									        <input type="file" class="form-control form-control-sm no-border" id="productImages" multiple onchange="previewImages()">
									        <div id="imagePreviewContainer" class="mt-3">
									            <!-- 미리보기 이미지가 여기에 표시됨 -->
									        </div>
									    </td>
									</tr>
			
									<tr>
									    <th scope="row" class="align-middle">썸네일 선택</th>
									    <td>
									        <select class="form-control form-control-sm" id="thumbnail" onchange="updateThumbnailPreview()">
									            <option value="">썸네일 선택</option>
									            <!-- 썸네일 목록은 자바스크립트로 동적으로 채워질 예정 -->
									        </select>
									        <div id="thumbnailPreview" class="mt-3">
									            <!-- 썸네일 미리보기 이미지 -->
									        </div>
									    </td>
									</tr>
										
										
			                        </tbody>
			                    </table>
			                </div>
			                <div class="d-flex justify-content-end">
			                    <button type="submit" class="btn btn-lg btn-success">등록</button>
			                </div>
			            </form>
			        </div>
			    </div>
			</div>



			<!-- Summernote CSS -->
			<link th:href="@{https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-bs4.min.css}" rel="stylesheet">

			<!-- Bootstrap 4 JS -->

			<!-- Summernote JS -->
			<script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/summernote-bs4.min.js}"></script>

			<!-- Summernote 한국어 설정 -->
			<script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/lang/summernote-ko-KR.min.js}"></script>

			
			
<script>
	var $jq = jQuery.noConflict();
	$jq(document).ready(function() {
	    // Summernote 에디터 초기화
	    $jq('#productContent').summernote({
	        height: 200,
	        placeholder: '상품 내용을 입력하세요...',
	        lang: 'ko-KR',  // 한국어 설정
	        toolbar: [
	            ['style', ['bold', 'italic', 'underline', 'clear']],
	            ['font', ['strikethrough', 'superscript', 'subscript']],
	            ['fontname', ['fontname']],
	            ['para', ['ul', 'ol', 'paragraph']],
	            ['table', ['table']],
	            ['insert', ['link', 'picture', 'video']],
	            ['view', ['fullscreen', 'codeview', 'help']]
	        ],
	        disableDragAndDrop: true,
	        focus: true,
	        callbacks: {
	            onImageUpload: function(files) {
	                var formData = new FormData();
	                formData.append("file", files[0]);

	                // 서버로 이미지 업로드 요청
	                $jq.ajax({
	                    url: '/management/products/uploadImage',  // RESTful 이미지 업로드 URL
	                    type: 'POST',
	                    data: formData,
	                    contentType: false,  // 자동으로 Content-Type을 설정하지 않음
	                    processData: false,  // 데이터를 자동으로 처리하지 않음
	                    success: function(response) {
	                        // 서버에서 반환된 이미지 URL을 사용하여 Summernote에 삽입
	                        if(response.fileUrl) {
	                            $jq('#productContent').summernote('insertImage', response.fileUrl);
	                        } else {
	                            console.log("이미지 업로드 실패");
	                        }
	                    },
	                    error: function(xhr, status, error) {
	                        console.log("이미지 업로드 실패:", error);
	                    }
	                });
	            }
	        },
	        minHeight: 150,
	        maxHeight: 500,
	        popover: {
	            image: ['resizeFull', 'resizeHalf', 'resizeQuarter', 'floatLeft', 'floatRight', 'imageProperties'],
	            link: ['linkDialogShow', 'unlink'],
	            air: ['style']
	        }
	    });
	});

</script>

	
<script>
		function previewImages() {
		    const files = document.getElementById('productImages').files;
		    const previewContainer = document.getElementById('imagePreviewContainer');
		    const thumbnailSelect = document.getElementById('thumbnail');
		    const thumbnailPreview = document.getElementById('thumbnailPreview');
		    
		    // 미리보기 컨테이너 초기화
		    previewContainer.innerHTML = '';
		    thumbnailSelect.innerHTML = '<option value="">썸네일 선택</option>'; // 썸네일 선택 목록 초기화
		    thumbnailPreview.innerHTML = ''; // 썸네일 미리보기 초기화
	
		    if (files.length === 0) {
		        return;
		    }
	
		    // 선택된 이미지 파일들을 하나씩 미리보기
		    for (let i = 0; i < files.length; i++) {
		        const file = files[i];
		        
		        // 이미지 파일인지 확인
		        if (file && file.type.startsWith('image/')) {
		            const reader = new FileReader();
		            
		            reader.onload = function(event) {
		                // 미리보기 이미지 생성
		                const imgElement = document.createElement('img');
		                imgElement.src = event.target.result;
		                imgElement.classList.add('img-fluid', 'preview-image');
		                imgElement.style.maxWidth = '150px'; // 크기 제한 (필요시 조정)
		                imgElement.style.margin = '5px';
		                
		                previewContainer.appendChild(imgElement);
		                
		                // 썸네일 선택 목록 추가
		                const option = document.createElement('option');
		                option.value = event.target.result; // 이미지의 Data URL을 값으로 설정
		                option.textContent = `Image ${i + 1}`;
		                thumbnailSelect.appendChild(option);
		            };
		            
		            // 파일을 읽어서 이미지를 미리보기
		            reader.readAsDataURL(file);
		        }
		    }
		}
	
		// 썸네일 선택 시 미리보기 업데이트
		function updateThumbnailPreview() {
		    const thumbnailSelect = document.getElementById('thumbnail');
		    const thumbnailPreview = document.getElementById('thumbnailPreview');
		    const selectedThumbnail = thumbnailSelect.value;
	
		    // 썸네일 미리보기 초기화
		    thumbnailPreview.innerHTML = '';
	
		    if (selectedThumbnail) {
		        const imgElement = document.createElement('img');
		        imgElement.src = selectedThumbnail;
		        imgElement.classList.add('img-fluid');
		        imgElement.style.maxWidth = '150px'; // 썸네일 미리보기 크기
		        imgElement.style.margin = '5px';
		        
		        thumbnailPreview.appendChild(imgElement);
		    }
		}
		   
		
</script>


	
<script>
	    // 카테고리에 따라 세분류 옵션을 업데이트하는 함수
	    function updateSubCategory() {
	        var category = document.getElementById("productCategory").value;
	        var subCategorySelect = document.getElementById("productCategoryDetails");
	        var subCategories = {
	            electronics: ["휴대폰", "컴퓨터", "카메라"],
	            clothing: ["상의", "하의", "아우터"],
	            books: ["소설", "에세이", "자기계발"]
	        };
	
	        // 세분류 박스를 초기화
	        subCategorySelect.innerHTML = '<option value="">세분류 선택</option>';
	
	        if (category) {
	            // 선택된 카테고리에 따라 세분류 항목을 추가
	            subCategories[category].forEach(function(subCategory) {
	                var option = document.createElement("option");
	                option.value = subCategory.toLowerCase();
	                option.text = subCategory;
	                subCategorySelect.appendChild(option);
	            });
	            subCategorySelect.style.display = "block"; // 세분류 박스 보이기
	        } else {
	            subCategorySelect.style.display = "none"; // 카테고리가 선택되지 않으면 세분류 박스 숨기기
	        }
	    }
</script>
	<!-- ㅇㄴㅁ-->
<script>
		document.addEventListener('DOMContentLoaded', function() {
		    const today = new Date();
		    const year = today.getFullYear();
		    const month = String(today.getMonth() + 1).padStart(2, '0');
		    const day = String(today.getDate()).padStart(2, '0');
		    const formattedDate = `${year}-${month}-${day}`;
		    
		    document.getElementById('createDate').value = formattedDate;
		});
		
</script>
	  
  
<script>
	function registerProduct() {
	    const formData = new FormData();
	    
	    // 일반 상품 데이터
	    formData.append('productId', document.getElementById('productId').value);
	    formData.append('productCategory', document.getElementById('productCategory').value);
	    formData.append('productCategoryDetails', document.getElementById('productCategoryDetails').value);
	    formData.append('productKeyword', document.getElementById('productKeyword').value);
	    formData.append('productName', document.getElementById('productName').value);
	    formData.append('productPrice', document.getElementById('productPrice').value);
	    formData.append('discountRate', document.getElementById('discountRate').value);
	    formData.append('productStock', document.getElementById('productStock').value);

		// 썸머노트에서 값 가져오기
		formData.append('productContent', $jq('#productContent').summernote('code'));  // 변경된 부분
		console.log('productContent:', productContent);  // 값 확인

		
	    formData.append('brand', document.getElementById('brand').value);
	    formData.append('manufacturer', document.getElementById('manufacturer').value);
	    formData.append('productOrigin', document.getElementById('productOrigin').value);
	    formData.append('createDate', document.getElementById('createDate').value);
	    formData.append('comments', document.getElementById('comments').value);

	    // 이미지 파일 (다중 이미지)
		const productImages = document.getElementById('productImages').files;
		if (productImages.length > 0) {
		    for (let i = 0; i < productImages.length; i++) {
		        formData.append('productImages', productImages[i]);
		    }
		} else {
		    console.error('이미지가 선택되지 않았습니다.');
		}

	    // 썸네일 선택
	    const thumbnailSelect = document.getElementById('thumbnail');
	    const selectedThumbnail = thumbnailSelect.value;
	    formData.append('thumbnail', selectedThumbnail);

	    // RESTful API 호출
	    fetch('/management/products/register', {
	        method: 'POST',
	        body: formData,  // FormData를 직접 전송
	    })
	    .then(response => response.json())
	    .then(data => {
	        console.log('상품 등록 성공:', data);
	        alert('상품이 등록되었습니다.');
			// 폼 초기화
			   document.getElementById('productForm').reset();  // productForm은 폼의 id입니다.
	    })
	    .catch(error => {
	        console.error('상품 등록 실패:', error);
	        alert('상품 등록에 실패했습니다.');
	    });
	}

	// 이미지 파일 선택 후 썸네일 목록 동적으로 추가
	document.getElementById('productImages').addEventListener('change', function() {
	    const thumbnailSelect = document.getElementById('thumbnail');
	    thumbnailSelect.innerHTML = '<option value="">썸네일 선택</option>'; // 초기화
	    
	    const files = this.files;
	    for (let i = 0; i < files.length; i++) {
	        const option = document.createElement('option');
	        option.value = files[i].name; // 파일 이름을 썸네일 값으로 사용
	        option.textContent = files[i].name; // 파일 이름을 옵션 텍스트로 사용
	        thumbnailSelect.appendChild(option);
	    }
	});


</script>
	
		 
		 
		 
		 


		 
		 
		 
		 
		 
		 
		 
		 
		 
			<!--  컨텐츠 작성란 -->			 
            <!-- End of Main Content -->

            <!-- Footer -->
      		<footer th:replace = "layout/footer :: footer"></footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->


	  <!-- Bootstrap 4 CSS -->
	  <link th:href="@{https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css}" rel="stylesheet">


	
	  <link rel="stylesheet" th:href="@{/css/registration.css}">
	  		


	
	

	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	
    <script src="/bootstrap/vendor/jquery/jquery.min.js"></script>
    <script src="/bootstrap/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="/bootstrap/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="/bootstrap/js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="/bootstrap/vendor/chart.js/Chart.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="/bootstrap/js/demo/chart-area-demo.js"></script>
    <script src="/bootstrap/js/demo/chart-pie-demo.js"></script>

</body>

</html>