<!DOCTYPE html>
<html lang="en">
	<html xmlns:th="http://www.thymeleaf.org">

	<style>
			/* 테이블 셀 내에서 텍스트가 줄바꿈되지 않도록 설정 */
			.table th, .table td {
			    white-space: nowrap; /* 줄바꿈 방지 */
			    text-align: center;   /* 텍스트를 가운데 정렬 */
				color: black; /* 텍스트 색상을 검은색으로 설정 */
				
			}

			
			.Modal {
			    display: none;
			    position: fixed;
			    left: 0;
			    top: 0;
			    width: 100%;
			    height: 100%;
			    background-color: rgba(0, 0, 0, 0.5);
			    backdrop-filter: blur(5px); /* 블러 효과 추가 */
			    justify-content: center;
			    align-items: center;
			    display: flex;
			}

			.modal-content {
			    background-color: white;
			    padding: 20px;
			    width: 90%;
			    max-width: 400px; /* 최대 크기 제한 */
			    border-radius: 12px;
			    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
			    position: relative;
			    animation: fadeIn 0.3s ease-in-out; /* 부드러운 등장 애니메이션 */
			}

			.close {
			    position: absolute;
			    top: 12px;
			    right: 15px;
			    font-size: 24px;
			    font-weight: bold;
			    color: #555;
			    cursor: pointer;
			    transition: color 0.2s;
			}

			.close:hover {
			    color: #000;
			}

			/* 모달 등장 애니메이션 */
			@keyframes fadeIn {
			    from {
			        opacity: 0;
			        transform: translateY(-20px);
			    }
			    to {
			        opacity: 1;
			        transform: translateY(0);
			    }
			}
			
			
			.pagination {
			    text-align: center;
			    margin-top: 20px;
			}

			.pagination button {
			    padding: 5px 10px;
			    margin: 0 5px;
			    background-color: #007bff;
			    color: white;
			    border: none;
			    cursor: pointer;
			    border-radius: 5px;
			}

			.pagination button:hover {
			    background-color: #0056b3;
			}

			#productTable th, #productTable td {
			    padding: 10px;
			    text-align: center;
			}
		
				
		</style>
	
<head th:replace="layout/header :: head (VIVIDO)">
	

	
	
</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
 	<sidebar th:replace="layout/sidebar :: sidebar"></sidebar>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
         <main th:replace="layout/main :: main"></main>
		<!--  컨텐츠 작성란 -->	
	<div class="card-body" style="background-color: white;">
		
				
	<div class="container-fluid">
		<div class="card shadow mb-4">
			<div class="card-header py-3">
			    <h1 style="display: inline; color: black;">* 상품관리</h1>
			</div>
				<div class="table-responsive">
					<table class="table table-bordered dataTable" id="productTable">			                
							<thead>
			                    <tr>
									<th class="sorting sorting_asc" tabindex="0" aria-controls="dataTable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Name: activate to sort column descending" style="width: 148px;">상품ID</th>
									<th style="white-space: nowrap; text-align: center;">상품명</th>
									<th style="white-space: nowrap; text-align: center;">가격</th>
									<th style="white-space: nowrap; text-align: center;">카테고리</th>
									<th style="white-space: nowrap; text-align: center;">카테고리 세분류</th>
									<th style="white-space: nowrap; text-align: center;">키워드</th>
									<th style="white-space: nowrap; text-align: center;">할인율</th>
									<th style="white-space: nowrap; text-align: center;">재고수량</th>
									<th style="white-space: nowrap; text-align: center;">상품옵션</th>
									<th style="white-space: nowrap; text-align: center;">상품 내용</th>
									<th style="white-space: nowrap; text-align: center;">상품 브랜드</th>
									<th style="white-space: nowrap; text-align: center;">상품 제조사</th>
									<th style="white-space: nowrap; text-align: center;">상품 원산지</th>
									<th style="white-space: nowrap; text-align: center;">상품 상태</th>
									<th style="white-space: nowrap; text-align: center;">배송 방법</th>
									<th style="white-space: nowrap; text-align: center;">택배 회사</th>
									<th style="white-space: nowrap; text-align: center;">배송비</th>
									<th style="white-space: nowrap; text-align: center;">출고지</th>
									<th style="white-space: nowrap; text-align: center;">상품 등록일자</th>
									<th style="white-space: nowrap; text-align: center;">상품 수정일자</th>
									<th style="white-space: nowrap; text-align: center;">승인일자</th>
									<th style="white-space: nowrap; text-align: center;">승인자</th>
									<th style="white-space: nowrap; text-align: center;">비고</th>
									<th style="white-space: nowrap; text-align: center;">수정</th>
									<th style="white-space: nowrap; text-align: center;">삭제</th>					
								</tr>
			                </thead>                        
			            <tbody>
							
						</tbody>
					</table>
			</div> 
		</div>                      
	</div>
	
	<!-- 상품 수정 모달 -->
	<div id="editModal" class="modal">
	    <div class="modal-content">
	        <span class="close" onclick="closeModal()">&times;</span>
	        <h2>상품 수정</h2>
	        <form id="editForm">
	            <input type="hidden" id="editProductId">

	            <label>상품명: <input type="text" id="editProductName"></label><br>
	            <label>가격: <input type="number" id="editPrice"></label><br>
	            <label>카테고리: <input type="text" id="editCategory"></label><br>
	            <label>카테고리 세분류: <input type="text" id="editCategoryDetails"></label><br>
	            <label>키워드: <input type="text" id="editKeyword"></label><br>
	            <label>재고수량: <input type="number" id="editStockQuantity"></label><br>
	            <label>상품 내용: <textarea id="editProductContent"></textarea></label><br>

	            <button type="button" onclick="saveEdit()">저장</button>
	            <button type="button" onclick="closeModal()">닫기</button>
	        </form>
	    </div>
	</div>
	
	
	<!-- 페이징 버튼 -->
	<div class="pagination">
	    <button id="firstPage" onclick="changePage(1)">처음</button>
	    <button id="prevPage" onclick="changePage(currentPage - 1)">이전</button>
	    <span id="pageInfo">페이지 1</span>
	    <button id="nextPage" onclick="changePage(currentPage + 1)">다음</button>
	    <button id="lastPage" onclick="changePage(totalPages)">끝</button>
	</div>
	
	
	
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script>
			let currentPage = 1;
			let totalPages = 10;

			// 상품 목록 및 페이징 처리 함수
			function loadProducts(pageNum) {
			    $.ajax({
			        url: "/management/products",  // 전체 상품 조회 API
			        type: "GET",
			        data: {
			            page: pageNum,  // 현재 페이지 번호
			            size: 10         // 페이지당 항목 수
			        },
			        dataType: "json",
			        success: function(response) {
			            // 응답 받은 데이터로 테이블 채우기
			            const products = response.products;
			            totalPages = response.totalPages;
			            currentPage = response.currentPage;

			            let tableContent = "";
			            products.forEach(function (product) {
			                tableContent += `
			                    <tr>
			                        <td>${product.productId}</td>
			                        <td>${product.productName}</td>
			                        <td>${product.productPrice} 원</td>
			                        <td>${product.productCategory}</td>
			                        <td>${product.productCategoryDetails}</td>
			                        <td>${product.productKeyword}</td>
			                        <td>${product.discountRate}%</td>
			                        <td>${product.productStock}</td>
			                        <td>${product.productOptionId ? '옵션 있음' : '옵션 없음'}</td>
			                        <td>${product.productContent}</td>
			                        <td>${product.brand}</td>
			                        <td>${product.manufacturer}</td>
			                        <td>${product.productOrigin}</td>
			                        <td>${product.productStatus}</td>
			                        <td>${product.deliveryMethod}</td>
			                        <td>${product.deliveryCompany}</td>
			                        <td>${product.deliveryPrice} 원</td>
			                        <td>${product.address}</td>
			                        <td>${product.createDate}</td>
			                        <td>${product.updateDate}</td>
			                        <td>${product.approvalDate}</td>
			                        <td>${product.approvalId}</td>
			                        <td>${product.comments}</td>
			                        <td>
			                            <button class="btn btn-warning btn-icon-split" onclick="editProduct('${product.productId}')">수정</button>
			                        </td>
			                        <td>
			                            <button class="btn btn-danger btn-icon-split" onclick="deleteProduct('${product.productId}')">삭제</button>
			                        </td>
			                    </tr>
			                `;
			            });
			            // 테이블의 tbody에 데이터를 삽입
			            $("#productTable tbody").html(tableContent);

			            // 페이징 UI 업데이트
			            updatePaginationUI(currentPage, totalPages);
			        },
			        error: function () {
			            alert("상품 목록을 불러오는 데 실패했습니다.");
			        }
			    });
			}

			// 페이징 UI 업데이트
			function updatePaginationUI(currentPage, totalPages) {
			    $("#pageInfo").text(`페이지 ${currentPage} / ${totalPages}`);

			    // 페이지 이동 버튼 활성화/비활성화 처리
			    $("#firstPage").prop("disabled", currentPage === 1);
			    $("#prevPage").prop("disabled", currentPage === 1);
			    $("#nextPage").prop("disabled", currentPage === totalPages);
			    $("#lastPage").prop("disabled", currentPage === totalPages);
			}

			// 페이지 변경 시 호출되는 함수
			function changePage(pageNum) {
			    if (pageNum < 1 || pageNum > totalPages) {
			        return; // 잘못된 페이지 번호일 경우 실행하지 않음
			    }
			    currentPage = pageNum;
			    loadProducts(currentPage);  // 해당 페이지의 상품 목록을 불러옴
			}

			// 페이지 로딩 시 기본 1페이지 상품 목록 불러오기
			$(document).ready(function() {
			    loadProducts(currentPage);
			});

			// 상품 수정 함수 (추가 구현 필요)
			// 수정 모달 열기
			function openEditModal(productId) {
			    // 상품 정보를 가져와서 모달에 입력
			    fetch(`/management/products/${productId}`)
			        .then(response => response.json())
			        .then(product => {
			            // 모달에 상품 정보 채우기
			            document.getElementById("editProductId").value = product.productId;
			            document.getElementById("editProductName").value = product.productName;
			            document.getElementById("editPrice").value = product.productPrice;
			            document.getElementById("editCategory").value = product.productCategory;
			            document.getElementById("editCategoryDetails").value = product.productCategoryDetails;
			            document.getElementById("editKeyword").value = product.productKeyword;
			            document.getElementById("editStockQuantity").value = product.productStock;
			            document.getElementById("editProductContent").value = product.productContent;

			            // 모달 창 띄우기
			            document.getElementById("editModal").style.display = "block";
			        })
			        .catch(error => console.log("상품 정보 로드 실패:", error));
			}

			// 수정 모달 닫기
			function closeModal() {
			    document.getElementById("editModal").style.display = "none";
			}

			// 수정된 정보 저장
			function saveEdit() {
			    const productId = document.getElementById("editProductId").value;
			    const updatedProduct = {
			        productId: productId,
			        productName: document.getElementById("editProductName").value,
			        productPrice: document.getElementById("editPrice").value,
			        productCategory: document.getElementById("editCategory").value,
			        productCategoryDetails: document.getElementById("editCategoryDetails").value,
			        productKeyword: document.getElementById("editKeyword").value,
			        productStock: document.getElementById("editStockQuantity").value,
			        productContent: document.getElementById("editProductContent").value
			    };

			    fetch(`/management/products/${productId}`, {
			        method: 'PUT',
			        headers: {
			            'Content-Type': 'application/json'
			        },
			        body: JSON.stringify(updatedProduct)
			    })
			    .then(response => {
			        if (response.ok) {
			            alert("상품 수정 성공");
			            closeModal();  // 모달 닫기
			            // 수정된 상품 목록 갱신 (필요시)
			            location.reload(); // 페이지 새로고침
			        } else {
			            alert("상품 수정 실패");
			        }
			    })
			    .catch(error => {
			        alert("수정 요청에 실패했습니다.");
			        console.error("수정 실패:", error);
			    });
			}

			// 상품 수정 버튼 클릭 시 호출
			function editProduct(productId) {
			    openEditModal(productId);
			}
			
			
			
			
			// 상품 삭제 함수 (확인창 포함)
			function deleteProduct(productId) {
			    if (confirm("정말 삭제하시겠습니까?")) {
			        $.ajax({
			            url: "/management/products/" + productId,
			            type: "DELETE",
			            success: function () {
			                alert("상품이 삭제되었습니다.");
			                location.reload(); // 삭제 후 새로고침
			            },
			            error: function () {
			                alert("상품 삭제에 실패했습니다.");
			            }
			        });
			    }
			}


		</script>
			
			
		
		<script>
		    let currentPage = 0;
		    let totalPages = 0;

		    // 페이지 로드 시 데이터 불러오기
		    function loadPage(page) {
		        fetch(`/products?page=${page}`)
		            .then(response => response.json())
		            .then(data => {
		                totalPages = data.totalPages; // 전체 페이지 수
		                currentPage = data.number; // 현재 페이지
		                updateTable(data.content); // 테이블 업데이트
		                updatePageInfo(); // 페이지 정보 업데이트
		            });
		    }

		    // 테이블에 데이터를 동적으로 삽입
		    function updateTable(products) {
		        const tableBody = document.querySelector('#productTable tbody');
		        tableBody.innerHTML = ''; // 기존 데이터 지우기

		        products.forEach(product => {
		            const row = document.createElement('tr');
		            row.innerHTML = `
		                <td>${product.productId}</td>
		                <td>${product.productName}</td>
		                <td>${product.price}</td>
		                <td>${product.category}</td>
		                <td>${product.categoryDetails}</td>
		                <td>${product.keyword}</td>
		                <td>${product.discount}</td>
		                <td>${product.stockQuantity}</td>
		                <td>${product.productContent}</td>
		            `;
		            tableBody.appendChild(row);
		        });
		    }

		    // 페이지 정보 업데이트
		    function updatePageInfo() {
		        document.getElementById('pageInfo').textContent = `페이지 ${currentPage + 1} / ${totalPages}`;
		    }

		    // 페이지 이동
		    function goToPage(page) {
		        if (page < 0 || page >= totalPages) return;
		        loadPage(page);
		    }

		    // 페이지 로드 시 첫 번째 페이지 데이터 불러오기
		    window.onload = function() {
		        loadPage(0);
		    };
		</script>
		
		
		
		
			
		</div>
<!--  컨텐츠 작성란 -->	 
		 

	<div class="card shadow mb-4">
	    <!-- Card Header - Dropdown -->
	   
	
	  
	</div>
		 
		 
	
		 
		 
		 
		 


		 
		 
		 
		 
		 
		 
		 
		 
		 
<!--  컨텐츠 작성란 -->			 
            <!-- End of Main Content -->

            <!-- Footer -->
      		<footer th:replace = "layout/footer :: footer"></footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>
	

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap core JavaScript-->
    <script src="/bootstrap/vendor/jquery/jquery.min.js"></script>
    <script src="/bootstrap/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="/bootstrap/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="/bootstrap/js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="/bootstrap/vendor/chart.js/Chart.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="/bootstrap/js/demo/chart-area-demo.js"></script>
    <script src="/bootstrap/js/demo/chart-pie-demo.js"></script>

</body>

</html>